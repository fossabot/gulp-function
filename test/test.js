/// <reference path="../ts/typings/main.d.ts" />
var gulp = require("gulp");
var gulpFunction = require("../dist/index.js");
var beautylog = require("beautylog");
var Q = require("q");
var myFunction = function () {
    var done = Q.defer();
    beautylog.log("Function executed");
    done.resolve();
    return done.promise;
};
var myFunction2 = function () {
    var done = Q.defer();
    beautylog.ok("Function2 executed");
    done.resolve();
    return done.promise;
};
var myFunction3 = function () {
    var done = Q.defer();
    beautylog.success("Function3 executed");
    done.resolve();
    return done.promise;
};
var beforeFunction = function () {
    var done = Q.defer();
    beautylog.success("beforeFunction executed");
    done.resolve();
    return done.promise;
};
var middleFunctionRun = false;
var middleFunction = function () {
    var done = Q.defer();
    beautylog.success("middleFunction executed");
    setTimeout(function () {
        beautylog.log("timeout fired");
        middleFunctionRun = true;
        done.resolve();
    }, 500);
    return done.promise;
};
var afterFunction = function () {
    var done = Q.defer();
    beautylog.success("afterFunction executed");
    done.resolve();
    return done.promise;
};
var timeoutFunction = function () {
    var done = Q.defer();
    setTimeout(function () {
        beautylog.log("largeTimeout fired");
        done.resolve();
    }, 2000);
    return done.promise;
};
describe("gulpFunction", function () {
    it("should run through smoothly with " + "'forEach'".blue, function (done) {
        gulp.src('./test/*.md')
            .pipe(gulpFunction(myFunction, 'forEach'))
            .pipe(gulp.dest("./test/result/"));
        gulp.src('./test/*.md')
            .pipe(gulpFunction([myFunction2, myFunction3], 'forEach'))
            .pipe(gulp.dest("./test/result/"))
            .pipe(gulpFunction(done, "atEnd"));
    });
    it("should run through smoothly with " + "'atEnd'".blue, function (done) {
        gulp.src('./test/*.md')
            .pipe(gulpFunction(myFunction, 'atEnd'))
            .pipe(gulp.dest("./test/result/"));
        gulp.src('./test/*.md')
            .pipe(gulpFunction([myFunction2, myFunction3], 'atEnd'))
            .pipe(gulp.dest("./test/result/"))
            .pipe(gulpFunction(done, "atEnd"));
    });
    it("should run through smoothly once with " + "'atFirst'".blue, function (done) {
        gulp.src('./test/*.md')
            .pipe(gulpFunction([myFunction2, myFunction3], 'forFirst'))
            .pipe(gulp.dest("./test/result/"))
            .pipe(gulpFunction(done, "atEnd"));
    });
    it("should run in order", function (done) {
        this.timeout(5000);
        var stream = gulp.src('./test/*.md')
            .pipe(gulpFunction([beforeFunction, middleFunction, middleFunction], 'atEnd'))
            .pipe(gulpFunction(function () {
            beautylog.log("stream progressed");
            var done2 = Q.defer();
            done2.resolve();
            return done2.promise;
        }, "forEach"))
            .pipe(gulpFunction(function () {
            beautylog.log("nextStep");
        }))
            .pipe(gulpFunction(afterFunction, "atEnd"))
            .pipe(gulpFunction(timeoutFunction, "atEnd"));
        stream.on("finish", function () {
            beautylog.info("stream finished");
            done();
        });
    });
});

//# sourceMappingURL=data:application/json;base64,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akQsTUFBTSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUM7WUFDZixTQUFTLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDbEMsSUFBSSxFQUFFLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoidGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi90cy90eXBpbmdzL21haW4uZC50c1wiIC8+XG52YXIgZ3VscCA9IHJlcXVpcmUoXCJndWxwXCIpO1xudmFyIGd1bHBGdW5jdGlvbiA9IHJlcXVpcmUoXCIuLi9kaXN0L2luZGV4LmpzXCIpO1xudmFyIGJlYXV0eWxvZyA9IHJlcXVpcmUoXCJiZWF1dHlsb2dcIik7XG52YXIgUSA9IHJlcXVpcmUoXCJxXCIpO1xuXG52YXIgbXlGdW5jdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZG9uZSA9IFEuZGVmZXIoKVxuICAgIGJlYXV0eWxvZy5sb2coXCJGdW5jdGlvbiBleGVjdXRlZFwiKTtcbiAgICBkb25lLnJlc29sdmUoKTtcbiAgICByZXR1cm4gZG9uZS5wcm9taXNlO1xufTtcbnZhciBteUZ1bmN0aW9uMiA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZG9uZSA9IFEuZGVmZXIoKTtcbiAgICBiZWF1dHlsb2cub2soXCJGdW5jdGlvbjIgZXhlY3V0ZWRcIik7XG4gICAgZG9uZS5yZXNvbHZlKCk7XG4gICAgcmV0dXJuIGRvbmUucHJvbWlzZTtcbn07XG52YXIgbXlGdW5jdGlvbjMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGRvbmUgPSBRLmRlZmVyKCk7XG4gICAgYmVhdXR5bG9nLnN1Y2Nlc3MoXCJGdW5jdGlvbjMgZXhlY3V0ZWRcIik7XG4gICAgZG9uZS5yZXNvbHZlKCk7XG4gICAgcmV0dXJuIGRvbmUucHJvbWlzZTtcbn07XG5cbnZhciBiZWZvcmVGdW5jdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZG9uZSA9IFEuZGVmZXIoKTtcbiAgICBiZWF1dHlsb2cuc3VjY2VzcyhcImJlZm9yZUZ1bmN0aW9uIGV4ZWN1dGVkXCIpO1xuICAgIGRvbmUucmVzb2x2ZSgpO1xuICAgIHJldHVybiBkb25lLnByb21pc2U7XG59O1xuXG52YXIgbWlkZGxlRnVuY3Rpb25SdW4gPSBmYWxzZTtcblxudmFyIG1pZGRsZUZ1bmN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBkb25lID0gUS5kZWZlcigpO1xuICAgIGJlYXV0eWxvZy5zdWNjZXNzKFwibWlkZGxlRnVuY3Rpb24gZXhlY3V0ZWRcIik7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICBiZWF1dHlsb2cubG9nKFwidGltZW91dCBmaXJlZFwiKTtcbiAgICAgICAgbWlkZGxlRnVuY3Rpb25SdW4gPSB0cnVlO1xuICAgICAgICBkb25lLnJlc29sdmUoKTtcbiAgICB9LCA1MDApO1xuICAgIHJldHVybiBkb25lLnByb21pc2U7XG59O1xuXG52YXIgYWZ0ZXJGdW5jdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZG9uZSA9IFEuZGVmZXIoKTtcbiAgICBiZWF1dHlsb2cuc3VjY2VzcyhcImFmdGVyRnVuY3Rpb24gZXhlY3V0ZWRcIik7XG4gICAgZG9uZS5yZXNvbHZlKCk7XG4gICAgcmV0dXJuIGRvbmUucHJvbWlzZTtcbn07XG5cbmxldCB0aW1lb3V0RnVuY3Rpb24gPSBmdW5jdGlvbigpe1xuICAgIHZhciBkb25lID0gUS5kZWZlcigpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgYmVhdXR5bG9nLmxvZyhcImxhcmdlVGltZW91dCBmaXJlZFwiKTtcbiAgICAgICAgZG9uZS5yZXNvbHZlKCk7XG4gICAgfSwyMDAwKTtcbiAgICByZXR1cm4gZG9uZS5wcm9taXNlO1xufTtcblxuXG5cbmRlc2NyaWJlKFwiZ3VscEZ1bmN0aW9uXCIsZnVuY3Rpb24oKXtcbiAgICBpdChcInNob3VsZCBydW4gdGhyb3VnaCBzbW9vdGhseSB3aXRoIFwiICsgXCInZm9yRWFjaCdcIi5ibHVlLGZ1bmN0aW9uKGRvbmUpe1xuICAgICAgICBndWxwLnNyYygnLi90ZXN0LyoubWQnKVxuICAgICAgICAgICAgLnBpcGUoZ3VscEZ1bmN0aW9uKG15RnVuY3Rpb24sJ2ZvckVhY2gnKSlcbiAgICAgICAgICAgIC5waXBlKGd1bHAuZGVzdChcIi4vdGVzdC9yZXN1bHQvXCIpKTtcblxuICAgICAgICBndWxwLnNyYygnLi90ZXN0LyoubWQnKVxuICAgICAgICAgICAgLnBpcGUoZ3VscEZ1bmN0aW9uKFtteUZ1bmN0aW9uMixteUZ1bmN0aW9uM10sJ2ZvckVhY2gnKSlcbiAgICAgICAgICAgIC5waXBlKGd1bHAuZGVzdChcIi4vdGVzdC9yZXN1bHQvXCIpKVxuICAgICAgICAgICAgLnBpcGUoZ3VscEZ1bmN0aW9uKGRvbmUsXCJhdEVuZFwiKSk7XG5cbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHJ1biB0aHJvdWdoIHNtb290aGx5IHdpdGggXCIgKyBcIidhdEVuZCdcIi5ibHVlLGZ1bmN0aW9uKGRvbmUpe1xuICAgICAgICBndWxwLnNyYygnLi90ZXN0LyoubWQnKVxuICAgICAgICAgICAgLnBpcGUoZ3VscEZ1bmN0aW9uKG15RnVuY3Rpb24sJ2F0RW5kJykpXG4gICAgICAgICAgICAucGlwZShndWxwLmRlc3QoXCIuL3Rlc3QvcmVzdWx0L1wiKSk7XG5cbiAgICAgICAgZ3VscC5zcmMoJy4vdGVzdC8qLm1kJylcbiAgICAgICAgICAgIC5waXBlKGd1bHBGdW5jdGlvbihbbXlGdW5jdGlvbjIsbXlGdW5jdGlvbjNdLCdhdEVuZCcpKVxuICAgICAgICAgICAgLnBpcGUoZ3VscC5kZXN0KFwiLi90ZXN0L3Jlc3VsdC9cIikpXG4gICAgICAgICAgICAucGlwZShndWxwRnVuY3Rpb24oZG9uZSxcImF0RW5kXCIpKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHJ1biB0aHJvdWdoIHNtb290aGx5IG9uY2Ugd2l0aCBcIiArIFwiJ2F0Rmlyc3QnXCIuYmx1ZSxmdW5jdGlvbihkb25lKXtcblxuICAgICAgICBndWxwLnNyYygnLi90ZXN0LyoubWQnKVxuICAgICAgICAgICAgLnBpcGUoZ3VscEZ1bmN0aW9uKFtteUZ1bmN0aW9uMixteUZ1bmN0aW9uM10sJ2ZvckZpcnN0JykpXG4gICAgICAgICAgICAucGlwZShndWxwLmRlc3QoXCIuL3Rlc3QvcmVzdWx0L1wiKSlcbiAgICAgICAgICAgIC5waXBlKGd1bHBGdW5jdGlvbihkb25lLFwiYXRFbmRcIikpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcnVuIGluIG9yZGVyXCIsZnVuY3Rpb24oZG9uZSl7XG4gICAgICAgIHRoaXMudGltZW91dCg1MDAwKTtcbiAgICAgICAgbGV0IHN0cmVhbSA9IGd1bHAuc3JjKCcuL3Rlc3QvKi5tZCcpXG4gICAgICAgICAgICAucGlwZShndWxwRnVuY3Rpb24oW2JlZm9yZUZ1bmN0aW9uLG1pZGRsZUZ1bmN0aW9uLG1pZGRsZUZ1bmN0aW9uXSwnYXRFbmQnKSlcbiAgICAgICAgICAgIC5waXBlKGd1bHBGdW5jdGlvbihmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIGJlYXV0eWxvZy5sb2coXCJzdHJlYW0gcHJvZ3Jlc3NlZFwiKTtcbiAgICAgICAgICAgICAgICB2YXIgZG9uZTIgPSBRLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgZG9uZTIucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBkb25lMi5wcm9taXNlO1xuICAgICAgICAgICAgfSxcImZvckVhY2hcIikpXG4gICAgICAgICAgICAucGlwZShndWxwRnVuY3Rpb24oZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBiZWF1dHlsb2cubG9nKFwibmV4dFN0ZXBcIik7XG4gICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIC5waXBlKGd1bHBGdW5jdGlvbihhZnRlckZ1bmN0aW9uLFwiYXRFbmRcIikpXG4gICAgICAgICAgICAucGlwZShndWxwRnVuY3Rpb24odGltZW91dEZ1bmN0aW9uLFwiYXRFbmRcIikpO1xuXG4gICAgICAgIHN0cmVhbS5vbihcImZpbmlzaFwiLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBiZWF1dHlsb2cuaW5mbyhcInN0cmVhbSBmaW5pc2hlZFwiKTtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KTtcblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
